<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Chromatographic peak detection using the massifquant method</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for findChromPeaks-massifquant {xcms}"><tr><td>findChromPeaks-massifquant {xcms}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Chromatographic peak detection using the massifquant method</h2>

<h3>Description</h3>

<p>Massifquant is a Kalman filter (KF)-based chromatographic peak
detection for XC-MS data in centroid mode. The identified peaks
can be further refined with the <em>centWave</em> method (see
<code><a href="findChromPeaks-centWave.html">findChromPeaks-centWave</a></code> for details on centWave)
by specifying <code>withWave = TRUE</code>.
</p>
<p>The <code>MassifquantParam</code> class allows to specify all
settings for a chromatographic peak detection using the massifquant
method eventually in combination with the centWave algorithm. Instances
should be created with the <code>MassifquantParam</code> constructor.
</p>
<p>The <code>findChromPeaks,OnDiskMSnExp,MassifquantParam</code>
method performs chromatographic peak detection using the
<em>massifquant</em> algorithm on all samples from an
<code><a href="../../MSnbase/html/OnDiskMSnExp-class.html">OnDiskMSnExp</a></code> object.
<code><a href="../../MSnbase/html/OnDiskMSnExp-class.html">OnDiskMSnExp</a></code> objects encapsule all experiment
specific data and load the spectra data (mz and intensity values) on the
fly from the original files applying also all eventual data
manipulations.
</p>
<p><code>ppm</code>,<code>ppm&lt;-</code>: getter and setter for the <code>ppm</code>
slot of the object.
</p>
<p><code>peakwidth</code>,<code>peakwidth&lt;-</code>: getter and setter for the
<code>peakwidth</code> slot of the object.
</p>
<p><code>snthresh</code>,<code>snthresh&lt;-</code>: getter and setter for the
<code>snthresh</code> slot of the object.
</p>
<p><code>prefilter</code>,<code>prefilter&lt;-</code>: getter and setter for the
<code>prefilter</code> slot of the object.
</p>
<p><code>mzCenterFun</code>,<code>mzCenterFun&lt;-</code>: getter and setter for the
<code>mzCenterFun</code> slot of the object.
</p>
<p><code>integrate</code>,<code>integrate&lt;-</code>: getter and setter for the
<code>integrate</code> slot of the object.
</p>
<p><code>mzdiff</code>,<code>mzdiff&lt;-</code>: getter and setter for the
<code>mzdiff</code> slot of the object.
</p>
<p><code>fitgauss</code>,<code>fitgauss&lt;-</code>: getter and setter for the
<code>fitgauss</code> slot of the object.
</p>
<p><code>noise</code>,<code>noise&lt;-</code>: getter and setter for the
<code>noise</code> slot of the object.
</p>
<p><code>verboseColumns</code>,<code>verboseColumns&lt;-</code>: getter and
setter for the <code>verboseColumns</code> slot of the object.
</p>
<p><code>criticalValue</code>,<code>criticalValue&lt;-</code>: getter and
setter for the <code>criticalValue</code> slot of the object.
</p>
<p><code>consecMissedLimit</code>,<code>consecMissedLimit&lt;-</code>: getter and
setter for the <code>consecMissedLimit</code> slot of the object.
</p>
<p><code>unions</code>,<code>unions&lt;-</code>: getter and
setter for the <code>unions</code> slot of the object.
</p>
<p><code>checkBack</code>,<code>checkBack&lt;-</code>: getter and
setter for the <code>checkBack</code> slot of the object.
</p>
<p><code>withWave</code>,<code>withWave&lt;-</code>: getter and
setter for the <code>withWave</code> slot of the object.
</p>


<h3>Usage</h3>

<pre>
MassifquantParam(ppm = 25, peakwidth = c(20, 50), snthresh = 10,
  prefilter = c(3, 100), mzCenterFun = "wMean", integrate = 1L,
  mzdiff = -0.001, fitgauss = FALSE, noise = 0,
  verboseColumns = FALSE, criticalValue = 1.125,
  consecMissedLimit = 2, unions = 1, checkBack = 0,
  withWave = FALSE)

## S4 method for signature 'OnDiskMSnExp,MassifquantParam'
findChromPeaks(object, param,
  BPPARAM = bpparam(), return.type = "XCMSnExp", msLevel = 1L)

## S4 method for signature 'MassifquantParam'
show(object)

## S4 method for signature 'MassifquantParam'
ppm(object)

## S4 replacement method for signature 'MassifquantParam'
ppm(object) &lt;- value

## S4 method for signature 'MassifquantParam'
peakwidth(object)

## S4 replacement method for signature 'MassifquantParam'
peakwidth(object) &lt;- value

## S4 method for signature 'MassifquantParam'
snthresh(object)

## S4 replacement method for signature 'MassifquantParam'
snthresh(object) &lt;- value

## S4 method for signature 'MassifquantParam'
prefilter(object)

## S4 replacement method for signature 'MassifquantParam'
prefilter(object) &lt;- value

## S4 method for signature 'MassifquantParam'
mzCenterFun(object)

## S4 replacement method for signature 'MassifquantParam'
mzCenterFun(object) &lt;- value

## S4 method for signature 'MassifquantParam'
integrate(f)

## S4 replacement method for signature 'MassifquantParam'
integrate(object) &lt;- value

## S4 method for signature 'MassifquantParam'
mzdiff(object)

## S4 replacement method for signature 'MassifquantParam'
mzdiff(object) &lt;- value

## S4 method for signature 'MassifquantParam'
fitgauss(object)

## S4 replacement method for signature 'MassifquantParam'
fitgauss(object) &lt;- value

## S4 method for signature 'MassifquantParam'
noise(object)

## S4 replacement method for signature 'MassifquantParam'
noise(object) &lt;- value

## S4 method for signature 'MassifquantParam'
verboseColumns(object)

## S4 replacement method for signature 'MassifquantParam'
verboseColumns(object) &lt;- value

## S4 method for signature 'MassifquantParam'
criticalValue(object)

## S4 replacement method for signature 'MassifquantParam'
criticalValue(object) &lt;- value

## S4 method for signature 'MassifquantParam'
consecMissedLimit(object)

## S4 replacement method for signature 'MassifquantParam'
consecMissedLimit(object) &lt;- value

## S4 method for signature 'MassifquantParam'
unions(object)

## S4 replacement method for signature 'MassifquantParam'
unions(object) &lt;- value

## S4 method for signature 'MassifquantParam'
checkBack(object)

## S4 replacement method for signature 'MassifquantParam'
checkBack(object) &lt;- value

## S4 method for signature 'MassifquantParam'
withWave(object)

## S4 replacement method for signature 'MassifquantParam'
withWave(object) &lt;- value
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>ppm</code></td>
<td>
<p><code>numeric(1)</code> defining the maximal tolerated m/z deviation in
consecutive scans in parts per million (ppm) for the initial ROI
definition.</p>
</td></tr>
<tr valign="top"><td><code>peakwidth</code></td>
<td>
<p><code>numeric(2)</code>. Only the first element is used by
massifquant, which specifices the minimum peak length in time scans.
For <code>withWave = TRUE</code> the second argument represents the maximum
peak length subject to being greater than the mininum peak length
(see also documentation of <code><a href="do_findChromPeaks_centWave.html">do_findChromPeaks_centWave</a></code>).</p>
</td></tr>
<tr valign="top"><td><code>snthresh</code></td>
<td>
<p><code>numeric(1)</code> defining the signal to noise ratio cutoff.</p>
</td></tr>
<tr valign="top"><td><code>prefilter</code></td>
<td>
<p><code>numeric(2)</code>. The first argument is only used
if (<code>withWave = TRUE</code>); see <code><a href="findChromPeaks-centWave.html">findChromPeaks-centWave</a></code>
for details. The second argument specifies the minimum threshold for the
maximum intensity of a chromatographic peak that must be met.</p>
</td></tr>
<tr valign="top"><td><code>mzCenterFun</code></td>
<td>
<p>Name of the function to calculate the m/z center of the
chromatographic peak. Allowed are: <code>"wMean"</code>: intensity weighted
mean of the peak's m/z values, <code>"mean"</code>: mean of the peak's m/z
values, <code>"apex"</code>: use the m/z value at the peak apex,
<code>"wMeanApex3"</code>: intensity weighted mean of the m/z value at the
peak apex and the m/z values left and right of it and <code>"meanApex3"</code>:
mean of the m/z value of the peak apex and the m/z values left and right
of it.</p>
</td></tr>
<tr valign="top"><td><code>integrate</code></td>
<td>
<p>Integration method. For <code>integrate = 1</code> peak limits
are found through descent on the mexican hat filtered data, for
<code>integrate = 2</code> the descent is done on the real data. The latter
method is more accurate but prone to noise, while the former is more
robust, but less exact.</p>
</td></tr>
<tr valign="top"><td><code>mzdiff</code></td>
<td>
<p><code>numeric(1)</code> representing the minimum difference in m/z
dimension required for peaks with overlapping retention times; can be
negative to allow overlap. During peak post-processing, peaks
defined to be overlapping are reduced to the one peak with the largest
signal.</p>
</td></tr>
<tr valign="top"><td><code>fitgauss</code></td>
<td>
<p><code>logical(1)</code> whether or not a Gaussian should be fitted
to each peak. This affects mostly the retention time position of the
peak.</p>
</td></tr>
<tr valign="top"><td><code>noise</code></td>
<td>
<p><code>numeric(1)</code> allowing to set a minimum intensity required
for centroids to be considered in the first analysis step (centroids with
intensity <code>&lt; noise</code> are omitted from ROI detection).</p>
</td></tr>
<tr valign="top"><td><code>verboseColumns</code></td>
<td>
<p><code>logical(1)</code> whether additional peak meta data
columns should be returned.</p>
</td></tr>
<tr valign="top"><td><code>criticalValue</code></td>
<td>
<p><code>numeric(1)</code>. Suggested values:
(<code>0.1-3.0</code>). This setting helps determine the the Kalman Filter
prediciton margin of error. A real centroid belonging to a bonafide
peak must fall within the KF prediction margin of error. Much like
in the construction of a confidence interval, <code>criticalVal</code> loosely
translates to be a multiplier of the standard error of the prediction
reported by the Kalman Filter. If the peak in the XC-MS sample have
a small mass deviance in ppm error, a smaller critical value might be
better and vice versa.</p>
</td></tr>
<tr valign="top"><td><code>consecMissedLimit</code></td>
<td>
<p><code>integer(1)</code> Suggested values: (<code>1,2,3</code>).
While a peak is in the proces of being detected by a Kalman Filter, the
Kalman Filter may not find a predicted centroid in every scan. After 1
or more consecutive failed predictions, this setting informs Massifquant
when to stop a Kalman Filter from following a candidate peak.</p>
</td></tr>
<tr valign="top"><td><code>unions</code></td>
<td>
<p><code>integer(1)</code> set to <code>1</code> if apply t-test union on
segmentation; set to <code>0</code> if no t-test to be applied on
chromatographically continous peaks sharing same m/z range.
Explanation: With very few data points, sometimes a Kalman Filter stops
tracking a peak prematurely. Another Kalman Filter is instantiated
and begins following the rest of the signal. Because tracking is done
backwards to forwards, this algorithmic defect leaves a real peak
divided into two segments or more. With this option turned on, the
program identifies segmented peaks and combines them (merges them)
into one with a two sample t-test. The potential danger of this option
is that some truly distinct peaks may be merged.</p>
</td></tr>
<tr valign="top"><td><code>checkBack</code></td>
<td>
<p><code>integer(1)</code> set to <code>1</code> if turned on; set to
<code>0</code> if turned off. The convergence of a Kalman Filter to a peak's
precise m/z mapping is very fast, but sometimes it incorporates erroneous
centroids as part of a peak (especially early on). The <code>scanBack</code>
option is an attempt to remove the occasional outlier that lies beyond
the converged bounds of the Kalman Filter. The option does not directly
affect identification of a peak because it is a postprocessing measure;
it has not shown to be a extremely useful thus far and the default is set
to being turned off.</p>
</td></tr>
<tr valign="top"><td><code>withWave</code></td>
<td>
<p><code>logical(1)</code> if <code>TRUE</code>, the peaks identified first
with Massifquant are subsequently filtered with the second step of the
centWave algorithm, which includes wavelet estimation.</p>
</td></tr>
<tr valign="top"><td><code>object</code></td>
<td>
<p>For <code>findChromPeaks</code>: an
<code><a href="../../MSnbase/html/OnDiskMSnExp-class.html">OnDiskMSnExp</a></code> object containing the MS- and all
other experiment-relevant data.
</p>
<p>For all other methods: a parameter object.</p>
</td></tr>
<tr valign="top"><td><code>param</code></td>
<td>
<p>An <code>MassifquantParam</code> object containing all settings for
the massifquant algorithm.</p>
</td></tr>
<tr valign="top"><td><code>BPPARAM</code></td>
<td>
<p>A parameter class specifying if and how parallel processing
should be performed. It defaults to <code><a href="../../BiocParallel/html/register.html">bpparam</a></code>.
See documentation of the <code>BiocParallel</code> for more details. If
parallel processing is enabled, peak detection is performed in parallel
on several of the input samples.</p>
</td></tr>
<tr valign="top"><td><code>return.type</code></td>
<td>
<p>Character specifying what type of object the method should
return. Can be either <code>"XCMSnExp"</code> (default), <code>"list"</code> or
<code>"xcmsSet"</code>.</p>
</td></tr>
<tr valign="top"><td><code>msLevel</code></td>
<td>
<p><code>integer(1)</code> defining the MS level on which the peak
detection should be performed. Defaults to <code>msLevel = 1</code>.</p>
</td></tr>
<tr valign="top"><td><code>value</code></td>
<td>
<p>The value for the slot.</p>
</td></tr>
<tr valign="top"><td><code>f</code></td>
<td>
<p>For <code>integrate</code>: a <code>MassifquantParam</code> object.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This algorithm's performance has been tested rigorously
on high resolution LC/OrbiTrap, TOF-MS data in centroid mode.
Simultaneous kalman filters identify chromatographic peaks and calculate
their area under the curve. The default parameters are set to operate on
a complex LC-MS Orbitrap sample. Users will find it useful to do some
simple exploratory data analysis to find out where to set a minimum
intensity, and identify how many scans an average peak spans. The
<code>consecMissedLimit</code> parameter has yielded good performance on
Orbitrap data when set to (<code>2</code>) and on TOF data it was found best
to be at (<code>1</code>). This may change as the algorithm has yet to be
tested on many samples. The <code>criticalValue</code> parameter is perhaps
most dificult to dial in appropriately and visual inspection of peak
identification is the best suggested tool for quick optimization.
The <code>ppm</code> and <code>checkBack</code> parameters have shown less influence
than the other parameters and exist to give users flexibility and
better accuracy.
</p>
<p>Parallel processing (one process per sample) is supported and can
be configured either by the <code>BPPARAM</code> parameter or by globally
defining the parallel processing mode using the
<code><a href="../../BiocParallel/html/register.html">register</a></code> method from the <code>BiocParallel</code>
package.
</p>


<h3>Value</h3>

<p>The <code>MassifquantParam</code> function returns a
<code>MassifquantParam</code> class instance with all of the settings
specified for chromatographic peak detection by the <em>massifquant</em>
method.
</p>
<p>For <code>findChromPeaks</code>: if <code>return.type = "XCMSnExp"</code> an
<code><a href="XCMSnExp-class.html">XCMSnExp</a></code> object with the results of the peak detection.
If <code>return.type = "list"</code> a list of length equal to the number of
samples with matrices specifying the identified peaks.
If <code>return.type = "xcmsSet"</code> an <code><a href="xcmsSet-class.html">xcmsSet</a></code> object
with the results of the peak detection.
</p>


<h3>Slots</h3>


<dl>
<dt><code>.__classVersion__,ppm,peakwidth,snthresh,prefilter,mzCenterFun,integrate,mzdiff,fitgauss,noise,verboseColumns,criticalValue,consecMissedLimit,unions,checkBack,withWave</code></dt><dd><p>See corresponding parameter above. <code>.__classVersion__</code> stores
the version from the class. Slots values should exclusively be accessed
<em>via</em> the corresponding getter and setter methods listed above.</p>
</dd>
</dl>


<h3>Note</h3>

<p>These methods and classes are part of the updated and modernized
<code>xcms</code> user interface which will eventually replace the
<code><a href="findPeaks-methods.html">findPeaks</a></code> methods. It supports chromatographic peak
detection on
<code><a href="../../MSnbase/html/OnDiskMSnExp-class.html">OnDiskMSnExp</a></code> objects (defined in the
<code>MSnbase</code> package). All of the settings to the massifquant and
centWave algorithm can be passed with a <code>MassifquantParam</code> object.
</p>


<h3>Author(s)</h3>

<p>Christopher Conley, Johannes Rainer
</p>


<h3>References</h3>

<p>Conley CJ, Smith R, Torgrip RJ, Taylor RM, Tautenhahn R and Prince JT
&quot;Massifquant: open-source Kalman filter-based XC-MS isotope trace feature
detection&quot; <em>Bioinformatics</em> 2014, 30(18):2636-43.
</p>


<h3>See Also</h3>

<p>The <code><a href="do_findChromPeaks_massifquant.html">do_findChromPeaks_massifquant</a></code> core API function
and <code><a href="findPeaks.massifquant-methods.html">findPeaks.massifquant</a></code> for the old user interface.
</p>
<p><code><a href="XCMSnExp-class.html">XCMSnExp</a></code> for the object containing the results of
the peak detection.
</p>
<p>Other peak detection methods: <code><a href="chromatographic-peak-detection.html">chromatographic-peak-detection</a></code>,
<code><a href="findChromPeaks-centWaveWithPredIsoROIs.html">findChromPeaks-centWaveWithPredIsoROIs</a></code>,
<code><a href="findChromPeaks-centWave.html">findChromPeaks-centWave</a></code>,
<code><a href="findChromPeaks-matchedFilter.html">findChromPeaks-matchedFilter</a></code>,
<code><a href="findPeaks-MSW.html">findPeaks-MSW</a></code>
</p>


<h3>Examples</h3>

<pre>

## Create a MassifquantParam object.
mqp &lt;- MassifquantParam()
## Change snthresh parameter
snthresh(mqp) &lt;- 30
mqp

## Perform the peak detection using massifquant on the files from the
## faahKO package. Files are read using the readMSData from the MSnbase
## package
library(faahKO)
library(MSnbase)
fls &lt;- dir(system.file("cdf/KO", package = "faahKO"), recursive = TRUE,
           full.names = TRUE)
raw_data &lt;- readMSData(fls[1:2], mode = "onDisk")
## Perform the peak detection using the settings defined above.
res &lt;- findChromPeaks(raw_data, param = mqp)
head(chromPeaks(res))
</pre>

<hr /><div style="text-align: center;">[Package <em>xcms</em> version 3.8.1 <a href="00Index.html">Index</a>]</div>
</body></html>
